<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Checker EOL & CVEs</title>

<style>
  * { box-sizing: border-box; }
  body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    background:#f4f6f8;
    color:#1f2328;
    margin:0;
    padding:2rem;
  }
  main {
    max-width:900px;
    margin:auto;
    background:#fff;
    padding:2rem;
    border-radius:14px;
    box-shadow:0 10px 25px rgba(0,0,0,.08);
  }

  h1 { color:#0a84ff; text-align:center; margin-bottom:1.5rem; }

  label { font-weight:600; margin-top:.8rem; display:block; }
  input, select {
    width:100%;
    padding:.6rem;
    border-radius:8px;
    border:1px solid #d0d7de;
    margin-top:.2rem;
  }

  button {
    margin-top:1.2rem;
    padding:.7rem;
    width:100%;
    background:#0a84ff;
    border:none;
    border-radius:8px;
    color:white;
    font-weight:600;
    cursor:pointer;
  }
  button:hover { background:#006edc; }

  .panel {
    margin-top:1.5rem;
    padding:1rem;
    border-radius:10px;
    background:#f9f9f9;
  }

  .verdict { font-size:1.2rem; font-weight:700; }
  .verdict.OBSOLETA { color:#c00; }
  .verdict.CON { color:#0a7; }

  table {
    width:100%;
    border-collapse:collapse;
    margin-top:1rem;
  }
  th, td {
    border:1px solid #d0d7de;
    padding:.6rem;
    text-align:left;
  }
  th { background:#0a84ff; color:white; }

  .tag {
    padding:.25rem .5rem;
    border-radius:6px;
    font-size:.85rem;
    font-weight:600;
    color:white;
  }
  .sev-CRITICAL { background:#c00; }
  .sev-HIGH { background:#e67e22; }
  .sev-MEDIUM { background:#f1c40f; color:#111; }
  .sev-LOW { background:#2ecc71; color:#111; }

  .muted { color:#555; font-style:italic; }
  a { color:#0a84ff; text-decoration:none; }
</style>
</head>

<body>
<main>
  <h1>Checker de soporte y CVEs</h1>

  <form id="form">
    <label>Tecnología</label>
    <input id="tec" value="openssl" required />

    <label>Versión</label>
    <input id="ver" value="1.0.1" required />

    <button type="submit">Consultar</button>
  </form>

  <section id="out" class="panel"></section>
</main>

<script>
const out = document.getElementById("out");

const fmtDate = d => d ? new Date(d).toLocaleDateString() : "-";
const sevTag = s => `<span class="tag sev-${s}">${s}</span>`;

document.getElementById("form").addEventListener("submit", async e => {
  e.preventDefault();
  out.innerHTML = "<em>Consultando…</em>";

  const tec = tecInput.value.trim();
  const ver = verInput.value.trim();

  try {
    const res = await fetch(`/check?tec=${encodeURIComponent(tec)}&ver=${encodeURIComponent(ver)}`);
    const data = await res.json();
    if (!res.ok) throw new Error(data.error);

    let html = `
      <div class="verdict ${data.veredicto}">${data.veredicto}</div>
      <p><strong>Tecnología:</strong> ${data.tecnologia.toUpperCase()} |
         <strong>Versión:</strong> ${data.version}</p>

      ${data.ciclo ? `
        <p>
          <strong>EOL:</strong> ${fmtDate(data.ciclo.eol)} |
          <strong>Latest ciclo:</strong> ${data.ciclo.latest || "-"}
        </p>` : ""}

      <p>
        <strong>Última versión con soporte:</strong>
        ${data.ultima_version_con_soporte || "<span class='muted'>No disponible</span>"}<br/>
        <strong>Última versión publicada:</strong>
        ${data.ultima_version_publicada || "-"}
      </p>

      <h4>Resumen CVEs</h4>
      <p>
        Total: ${data.summary.total}
        ${sevTag("CRITICAL")} ${data.summary.CRITICAL}
        ${sevTag("HIGH")} ${data.summary.HIGH}
        ${sevTag("MEDIUM")} ${data.summary.MEDIUM}
        ${sevTag("LOW")} ${data.summary.LOW}
      </p>
    `;

    if (data.cves.length) {
      html += `
        <table>
          <thead>
            <tr>
              <th>ID</th><th>Severidad</th><th>Score</th><th>Publicado</th>
            </tr>
          </thead>
          <tbody>
            ${data.cves.map(c => `
              <tr>
                <td><a href="${c.url}" target="_blank">${c.id}</a></td>
                <td>${sevTag(c.severity)}</td>
                <td>${c.score}</td>
                <td>${fmtDate(c.published)}</td>
              </tr>`).join("")}
          </tbody>
        </table>
      `;
    } else {
      html += `<p class="muted">No se encontraron CVEs para esta versión.</p>`;
    }

    out.innerHTML = html;

  } catch (err) {
    out.innerHTML = `<p class="muted">Error: ${err.message}</p>`;
  }
});
</script>
</body>
</html>
