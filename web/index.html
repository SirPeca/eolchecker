<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Checker de Soporte & CVEs</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: system-ui; background:#0f172a; color:#e5e7eb; padding:2rem; }
.card { background:#020617; padding:1.5rem; border-radius:10px; max-width:900px; margin:auto; }
input,button { padding:.6rem; width:100%; margin-top:.5rem; border-radius:6px; border:none; }
button { background:#2563eb; color:white; font-weight:bold; cursor:pointer; }
button:hover { background:#1e40af; }
.tag { padding:.2rem .5rem; border-radius:5px; font-size:.8rem; }
.CRITICAL{background:#dc2626} .HIGH{background:#f97316}
.MEDIUM{background:#eab308} .LOW{background:#22c55e}
.ok{color:#22c55e} .warn{color:#f97316} .bad{color:#dc2626}
</style>
</head>

<body>
<div class="card">
<h2>Checker de soporte y CVEs</h2>

<input id="tec" placeholder="Tecnología (ej: openssl)">
<input id="ver" placeholder="Versión (ej: 1.0.1)">
<button onclick="check()">Consultar</button>

<div id="out" style="margin-top:1rem"></div>
</div>

<script>
async function check(){
  const tec = tecInput.value.trim();
  const ver = verInput.value.trim();
  out.innerHTML = "<em>Consultando...</em>";

  try {
    const r = await fetch(`/check?tec=${encodeURIComponent(tec)}&ver=${encodeURIComponent(ver)}`);
    const j = await r.json();
    if(!r.ok) throw j;

    const statusClass =
      j.estado==="CON SOPORTE"?"ok":
      j.estado==="DESACTUALIZADO"?"warn":"bad";

    out.innerHTML = `
      <p class="${statusClass}"><b>${j.estado}</b></p>
      <p>Última versión publicada: ${j.latestVersion || "-"}</p>
      <p>Última versión con soporte: ${j.latestSupportedVersion || "-"}</p>
      <p>Total CVEs: ${j.resumen.total} | CRITICAL: ${j.resumen.critical} | HIGH: ${j.resumen.high}</p>
      <ul>
        ${j.cves.map(c=>`
          <li>
            <span class="tag ${c.severity}">${c.severity}</span>
            <a href="${c.url}" target="_blank">${c.id}</a>
          </li>`).join("")}
      </ul>
    `;
  } catch(e){
    out.innerHTML = `<span class="bad">Error</span>`;
  }
}

const tecInput=document.getElementById("tec");
const verInput=document.getElementById("ver");
const out=document.getElementById("out");
</script>
</body>
</html>
