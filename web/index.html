<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>EOL & CVE Checker</title>
<style>
body {
  font-family: Inter, system-ui, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  margin: 0;
  padding: 40px;
}
.container {
  max-width: 900px;
  margin: auto;
}
input, button, select {
  padding: 10px;
  margin: 5px;
  border-radius: 6px;
  border: none;
}
button {
  background: #2563eb;
  color: white;
  cursor: pointer;
}
button:disabled {
  background: #475569;
}
.summary {
  margin: 20px 0;
}
.cve {
  background: #020617;
  padding: 12px;
  margin: 10px 0;
  border-left: 6px solid gray;
}
.CRITICAL { border-color: #ef4444; }
.HIGH { border-color: #f97316; }
.MEDIUM { border-color: #facc15; }
.LOW { border-color: #22c55e; }
a { color: #38bdf8; }
</style>
</head>

<body>
<div class="container">
<h1>Checker de soporte y CVEs</h1>

<input id="tech" placeholder="Tecnología" />
<input id="version" placeholder="Versión" />

<select id="severity">
  <option value="ALL">Todas</option>
  <option value="CRITICAL">Critical</option>
  <option value="HIGH">High</option>
  <option value="MEDIUM">Medium</option>
  <option value="LOW">Low</option>
</select>

<button id="btn">Consultar</button>

<div id="status"></div>
<div id="info"></div>
<div id="summary" class="summary"></div>
<div id="results"></div>
</div>

<script>
const btn = document.getElementById("btn");

btn.onclick = async () => {
  const tech = document.getElementById("tech").value.trim();
  const version = document.getElementById("version").value.trim();
  const filter = document.getElementById("severity").value;

  if (!tech || !version) {
    alert("Completa tecnología y versión");
    return;
  }

  btn.disabled = true;
  document.getElementById("status").innerText = "Consultando...";
  document.getElementById("results").innerHTML = "";

  const res = await fetch(`/check?tech=${tech}&version=${version}`);
  const data = await res.json();

  btn.disabled = false;
  document.getElementById("status").innerText = "";

  document.getElementById("info").innerHTML = `
    <b>Última versión publicada:</b> ${data.latest_version}<br>
    <b>Última versión con soporte:</b> ${data.latest_supported_version}
  `;

  document.getElementById("summary").innerText =
    `Total CVEs: ${data.summary.total} | ` +
    `CRITICAL: ${data.summary.CRITICAL} | ` +
    `HIGH: ${data.summary.HIGH}`;

  data.cves
    .filter(c => filter === "ALL" || c.severity === filter)
    .forEach(cve => {
      const div = document.createElement("div");
      div.className = `cve ${cve.severity}`;
      div.innerHTML = `
        <b>${cve.id}</b> (${cve.severity})<br>
        ${cve.description}<br>
        <a href="${cve.url}" target="_blank">Ver en NVD</a>
      `;
      document.getElementById("results").appendChild(div);
    });
};
</script>
</body>
</html>
